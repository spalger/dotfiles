#!/usr/bin/env bash

if [[ -z $(which gist) ]]; then
  echo 'you must first install gist-cli from npm'
  exit 1
fi

# collect untracked and not-ignored paths
untracked="$(git ls-files -o --exclude-per-directory .gitignore)"

# add untracked files to the index temporarily
git add -N $untracked

# diff HEAD includes stages and unstaged changes
git diff HEAD --patch "$@" | \
  gist --anonymous --no-private --no-open --type diff --copy

# restore untracked status of previously untracked files
git reset $untracked --quiet